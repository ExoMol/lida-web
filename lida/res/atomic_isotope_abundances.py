import requests
from lxml import html


def get_nist_isotope_abundances():
    page = requests.get('https://physics.nist.gov/cgi-bin/Compositions/stand_alone.pl?ele=&all=all')
    tree = html.fromstring(page.content)

    rows = tree.xpath('//table/tbody/tr')[2:]

    isotopes = {}

    element = None
    for row in rows:
        if element is not None and len(row.xpath('td')) == 1:
            if element in isotopes:
                isotopes[element].sort(key=lambda x: -x[1])
            element = None
        tds = row.xpath('td')
        if element is None:
            if len(tds) == 1:
                continue
            else:
                element = tds[1].text.strip()
                if element == 'Og':
                    break
                offset = 2
        else:
            if element == 'H':
                offset = 1
            else:
                offset = 0
        isotope = f'({int(tds[offset].text.strip())}{element})'
        abundance = tds[offset + 2].text.strip().replace('\xa0', '').split('(')[0]
        if not abundance:
            continue
        abundance = float(abundance)
        try:
            isotopes[element].append((isotope, abundance))
        except KeyError:
            isotopes[element] = [(isotope, abundance), ]

    return isotopes


# isotope_abundances = get_nist_isotope_abundances()
# print(isotope_abundances)

# Isotopes for all the elements available on the NIST page (see the function above) and sorted by abundances.
isotope_abundances = {
    'H': [('(1H)', 0.999885), ('(2H)', 0.000115)], 'He': [('(4He)', 0.99999866), ('(3He)', 1.34e-06)],
    'Li': [('(7Li)', 0.9241), ('(6Li)', 0.0759)], 'Be': [('(9Be)', 1.0)],
    'B': [('(11B)', 0.801), ('(10B)', 0.199)],
    'C': [('(12C)', 0.9893), ('(13C)', 0.0107)], 'N': [('(14N)', 0.99636), ('(15N)', 0.00364)],
    'O': [('(16O)', 0.99757), ('(18O)', 0.00205), ('(17O)', 0.00038)], 'F': [('(19F)', 1.0)],
    'Ne': [('(20Ne)', 0.9048), ('(22Ne)', 0.0925), ('(21Ne)', 0.0027)], 'Na': [('(23Na)', 1.0)],
    'Mg': [('(24Mg)', 0.7899), ('(26Mg)', 0.1101), ('(25Mg)', 0.1)], 'Al': [('(27Al)', 1.0)],
    'Si': [('(28Si)', 0.92223), ('(29Si)', 0.04685), ('(30Si)', 0.03092)], 'P': [('(31P)', 1.0)],
    'S': [('(32S)', 0.9499), ('(34S)', 0.0425), ('(33S)', 0.0075), ('(36S)', 0.0001)],
    'Cl': [('(35Cl)', 0.7576), ('(37Cl)', 0.2424)],
    'Ar': [('(40Ar)', 0.996035), ('(36Ar)', 0.003336), ('(38Ar)', 0.000629)],
    'K': [('(39K)', 0.932581), ('(41K)', 0.067302), ('(40K)', 0.000117)],
    'Ca': [('(40Ca)', 0.96941), ('(44Ca)', 0.02086), ('(42Ca)', 0.00647), ('(48Ca)', 0.00187), ('(43Ca)', 0.00135),
           ('(46Ca)', 4e-05)], 'Sc': [('(45Sc)', 1.0)],
    'Ti': [('(48Ti)', 0.7372), ('(46Ti)', 0.0825), ('(47Ti)', 0.0744), ('(49Ti)', 0.0541), ('(50Ti)', 0.0518)],
    'V': [('(51V)', 0.9975), ('(50V)', 0.0025)],
    'Cr': [('(52Cr)', 0.83789), ('(53Cr)', 0.09501), ('(50Cr)', 0.04345), ('(54Cr)', 0.02365)],
    'Mn': [('(55Mn)', 1.0)],
    'Fe': [('(56Fe)', 0.91754), ('(54Fe)', 0.05845), ('(57Fe)', 0.02119), ('(58Fe)', 0.00282)],
    'Co': [('(59Co)', 1.0)],
    'Ni': [('(58Ni)', 0.68077), ('(60Ni)', 0.26223), ('(62Ni)', 0.036346), ('(61Ni)', 0.011399), ('(64Ni)', 0.009255)],
    'Cu': [('(63Cu)', 0.6915), ('(65Cu)', 0.3085)],
    'Zn': [('(64Zn)', 0.4917), ('(66Zn)', 0.2773), ('(68Zn)', 0.1845), ('(67Zn)', 0.0404), ('(70Zn)', 0.0061)],
    'Ga': [('(69Ga)', 0.60108), ('(71Ga)', 0.39892)],
    'Ge': [('(74Ge)', 0.365), ('(72Ge)', 0.2745), ('(70Ge)', 0.2057), ('(73Ge)', 0.0775), ('(76Ge)', 0.0773)],
    'As': [('(75As)', 1.0)],
    'Se': [('(80Se)', 0.4961), ('(78Se)', 0.2377), ('(76Se)', 0.0937), ('(82Se)', 0.0873), ('(77Se)', 0.0763),
           ('(74Se)', 0.0089)], 'Br': [('(79Br)', 0.5069), ('(81Br)', 0.4931)],
    'Kr': [('(84Kr)', 0.56987), ('(86Kr)', 0.17279), ('(82Kr)', 0.11593), ('(83Kr)', 0.115), ('(80Kr)', 0.02286),
           ('(78Kr)', 0.00355)], 'Rb': [('(85Rb)', 0.7217), ('(87Rb)', 0.2783)],
    'Sr': [('(88Sr)', 0.8258), ('(86Sr)', 0.0986), ('(87Sr)', 0.07), ('(84Sr)', 0.0056)],
    'Y': [('(89Y)', 1.0)],
    'Zr': [('(90Zr)', 0.5145), ('(94Zr)', 0.1738), ('(92Zr)', 0.1715), ('(91Zr)', 0.1122), ('(96Zr)', 0.028)],
    'Nb': [('(93Nb)', 1.0)],
    'Mo': [('(98Mo)', 0.2439), ('(96Mo)', 0.1667), ('(95Mo)', 0.1584), ('(92Mo)', 0.1453), ('(100Mo)', 0.0982),
           ('(97Mo)', 0.096), ('(94Mo)', 0.0915)],
    'Ru': [('(102Ru)', 0.3155), ('(104Ru)', 0.1862), ('(101Ru)', 0.1706), ('(99Ru)', 0.1276), ('(100Ru)', 0.126),
           ('(96Ru)', 0.0554), ('(98Ru)', 0.0187)], 'Rh': [('(103Rh)', 1.0)],
    'Pd': [('(106Pd)', 0.2733), ('(108Pd)', 0.2646), ('(105Pd)', 0.2233), ('(110Pd)', 0.1172), ('(104Pd)', 0.1114),
           ('(102Pd)', 0.0102)], 'Ag': [('(107Ag)', 0.51839), ('(109Ag)', 0.48161)],
    'Cd': [('(114Cd)', 0.2873), ('(112Cd)', 0.2413), ('(111Cd)', 0.128), ('(110Cd)', 0.1249), ('(113Cd)', 0.1222),
           ('(116Cd)', 0.0749), ('(106Cd)', 0.0125), ('(108Cd)', 0.0089)],
    'In': [('(115In)', 0.9571), ('(113In)', 0.0429)],
    'Sn': [('(120Sn)', 0.3258), ('(118Sn)', 0.2422), ('(116Sn)', 0.1454), ('(119Sn)', 0.0859), ('(117Sn)', 0.0768),
           ('(124Sn)', 0.0579), ('(122Sn)', 0.0463), ('(112Sn)', 0.0097), ('(114Sn)', 0.0066), ('(115Sn)', 0.0034)],
    'Sb': [('(121Sb)', 0.5721), ('(123Sb)', 0.4279)],
    'Te': [('(130Te)', 0.3408), ('(128Te)', 0.3174), ('(126Te)', 0.1884), ('(125Te)', 0.0707), ('(124Te)', 0.0474),
           ('(122Te)', 0.0255), ('(123Te)', 0.0089), ('(120Te)', 0.0009)], 'I': [('(127I)', 1.0)],
    'Xe': [('(132Xe)', 0.269086), ('(129Xe)', 0.264006), ('(131Xe)', 0.212324), ('(134Xe)', 0.104357),
           ('(136Xe)', 0.088573), ('(130Xe)', 0.04071), ('(128Xe)', 0.019102), ('(124Xe)', 0.000952),
           ('(126Xe)', 0.00089)], 'Cs': [('(133Cs)', 1.0)],
    'Ba': [('(138Ba)', 0.71698), ('(137Ba)', 0.11232), ('(136Ba)', 0.07854), ('(135Ba)', 0.06592), ('(134Ba)', 0.02417),
           ('(130Ba)', 0.00106), ('(132Ba)', 0.00101)],
    'La': [('(139La)', 0.9991119), ('(138La)', 0.0008881)],
    'Ce': [('(140Ce)', 0.8845), ('(142Ce)', 0.11114), ('(138Ce)', 0.00251), ('(136Ce)', 0.00185)],
    'Pr': [('(141Pr)', 1.0)],
    'Nd': [('(142Nd)', 0.27152), ('(144Nd)', 0.23798), ('(146Nd)', 0.17189), ('(143Nd)', 0.12174), ('(145Nd)', 0.08293),
           ('(148Nd)', 0.05756), ('(150Nd)', 0.05638)],
    'Sm': [('(152Sm)', 0.2675), ('(154Sm)', 0.2275), ('(147Sm)', 0.1499), ('(149Sm)', 0.1382), ('(148Sm)', 0.1124),
           ('(150Sm)', 0.0738), ('(144Sm)', 0.0307)],
    'Eu': [('(153Eu)', 0.5219), ('(151Eu)', 0.4781)],
    'Gd': [('(158Gd)', 0.2484), ('(160Gd)', 0.2186), ('(156Gd)', 0.2047), ('(157Gd)', 0.1565), ('(155Gd)', 0.148),
           ('(154Gd)', 0.0218), ('(152Gd)', 0.002)], 'Tb': [('(159Tb)', 1.0)],
    'Dy': [('(164Dy)', 0.2826), ('(162Dy)', 0.25475), ('(163Dy)', 0.24896), ('(161Dy)', 0.18889), ('(160Dy)', 0.02329),
           ('(158Dy)', 0.00095), ('(156Dy)', 0.00056)], 'Ho': [('(165Ho)', 1.0)],
    'Er': [('(166Er)', 0.33503), ('(168Er)', 0.26978), ('(167Er)', 0.22869), ('(170Er)', 0.1491), ('(164Er)', 0.01601),
           ('(162Er)', 0.00139)], 'Tm': [('(169Tm)', 1.0)],
    'Yb': [('(174Yb)', 0.32026), ('(172Yb)', 0.2168), ('(173Yb)', 0.16103), ('(171Yb)', 0.1409), ('(176Yb)', 0.12996),
           ('(170Yb)', 0.02982), ('(168Yb)', 0.00123)],
    'Lu': [('(175Lu)', 0.97401), ('(176Lu)', 0.02599)],
    'Hf': [('(180Hf)', 0.3508), ('(178Hf)', 0.2728), ('(177Hf)', 0.186), ('(179Hf)', 0.1362), ('(176Hf)', 0.0526),
           ('(174Hf)', 0.0016)], 'Ta': [('(181Ta)', 0.9998799), ('(180Ta)', 0.0001201)],
    'W': [('(184W)', 0.3064), ('(186W)', 0.2843), ('(182W)', 0.265), ('(183W)', 0.1431), ('(180W)', 0.0012)],
    'Re': [('(187Re)', 0.626), ('(185Re)', 0.374)],
    'Os': [('(192Os)', 0.4078), ('(190Os)', 0.2626), ('(189Os)', 0.1615), ('(188Os)', 0.1324), ('(187Os)', 0.0196),
           ('(186Os)', 0.0159), ('(184Os)', 0.0002)], 'Ir': [('(193Ir)', 0.627), ('(191Ir)', 0.373)],
    'Pt': [('(195Pt)', 0.3378), ('(194Pt)', 0.3286), ('(196Pt)', 0.2521), ('(198Pt)', 0.07356), ('(192Pt)', 0.00782),
           ('(190Pt)', 0.00012)], 'Au': [('(197Au)', 1.0)],
    'Hg': [('(202Hg)', 0.2986), ('(200Hg)', 0.231), ('(199Hg)', 0.1687), ('(201Hg)', 0.1318), ('(198Hg)', 0.0997),
           ('(204Hg)', 0.0687), ('(196Hg)', 0.0015)],
    'Tl': [('(205Tl)', 0.7048), ('(203Tl)', 0.2952)],
    'Pb': [('(208Pb)', 0.524), ('(206Pb)', 0.241), ('(207Pb)', 0.221), ('(204Pb)', 0.014)],
    'Bi': [('(209Bi)', 1.0)],
    'Th': [('(232Th)', 1.0)], 'Pa': [('(231Pa)', 1.0)],
    'U': [('(238U)', 0.992742), ('(235U)', 0.007204), ('(234U)', 5.4e-05)]
}
